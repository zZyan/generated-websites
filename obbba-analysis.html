<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OBBBA Financial Impact Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Poppins:wght@400;600;700&family=Kalam:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Embedded Language Content Files -->
    <script>
        /**
         * English content for the OBBBA Financial Impact Analyzer.
         */
        const en = {
            headerTitle: "OBBBA Impact Analyzer",
            headerSubtitle: "An analysis of the financial effects of the \"One Big Beautiful Bill Act\".",
            langToggle: "ä¸­æ–‡",
            summaryTitle: "Fiscal Vibe Check (10-Year Outlook)",
            kpiTaxCuts: "Tax Cuts",
            kpiSpendingReductions: "Spending<br>Reductions",
            kpiNetDebtIncrease: "Net Debt Increase",
            chartTitle: "Fiscal Action Comparison",
            breakdownTitle: "The Breakdown",
            faqDebtTitle: "Economic Impact of Higher National Debt?",
            faqDebtContent: "Increased national debt can lead to higher interest rates, which raises borrowing costs for consumers and businesses. It may also exert downward pressure on the US dollar's value and contribute to inflation, potentially reducing household purchasing power over time.",
            faqPersonalFinanceTitle: "Long-Term Impact on Personal Finances?",
            faqPersonalFinanceContent: "Potential short-term tax savings could be offset over the long term by higher interest rates on loans, inflation, and increased costs for healthcare and energy due to cuts in federal programs and the repeal of clean energy incentives.",
            faqEconomistsTitle: "What Top Economists Say",
            quoteSummers: `"Large-scale, unfunded tax cuts are a recipe for higher inflation and will ultimately burden future generations with unsustainable debt."`,
            quoteSummersCite: "- Larry Summers",
            quoteLustig: `"The convenience yield on government debt is a key indicator. Fiscal policies that dramatically increase the supply of debt without a clear path to repayment risk eroding that advantage, leading to higher financing costs for the government."`,
            quoteLustigCite: "- Hanno Lustig",
            policyTitle: "The Main Character Changes",
            glowUpsTitle: "The Glow Ups (Tax Breaks)",
            saltDeductionTitle: "SALT Deduction Cap Increase",
            saltDeductionDesc: "The cap is raised to $40,000 for taxpayers with AGI of $500,000 or less. The cap reverts to $10,000 for those with higher incomes.",
            childTaxCreditTitle: "Child Tax Credit Enhancement",
            childTaxCreditDesc: "The credit is permanently increased from $2,000 to $2,200 per child.",
            tipOvertimeTitle: "Tip & Overtime Deductions",
            tipOvertimeDesc: "A temporary deduction for federal income tax on tip and overtime pay is created.",
            nerfsTitle: "The Nerfs (Cost Increases)",
            repealEnergyTitle: "Repeal of Energy Credits",
            repealEnergyDesc: "Federal tax credits for EVs and residential solar installations are scheduled to end after 2025.",
            energyCostTitle: "Projected Energy Cost Increases",
            energyCostDesc: "Analysis indicates the rollback of clean energy incentives may lead to higher average household energy costs.",
            socialProgramsTitle: "Cuts to Social Programs",
            socialProgramsDesc: "Changes to Medicaid and SNAP eligibility may increase out-of-pocket costs for affected households.",
            calculatorTitle: "Your Personal Impact Calc",
            calculatorSubtitle: "Enter your deets for a personalized estimate.",
            agiLabel: "Adjusted Gross Income (AGI)",
            stateLabel: "State of Residence",
            stateTooltipTitle: "Why does this matter?",
            stateTooltipContent: "The 2017 TCJA introduced a $10k cap on deducting State & Local Taxes (SALT), which primarily affected residents of high-tax states. The OBBBA temporarily raises this cap, providing significant, direct relief to those same states while having little effect on low-tax states.",
            filingStatusLabel: "Filing Status",
            filingStatusSingle: "Single",
            filingStatusMfj: "Married Filing Jointly",
            advancedOptions: "Advanced Options",
            childrenLabel: "Number of Children (under 17)",
            propertyTaxLabel: "Annual Property Tax",
            overtimeLabel: "Annual Overtime Income",
            overtimeDesc: "OBBBA deduction max $12.5k (Single) / $25k (Joint).",
            tipsLabel: "Annual Tip Income",
            tipsDesc: "OBBBA deduction max $25k.",
            evSolarLabel: "I am planning EV or Solar upgrades after 2025.",
            calculateButton: "Calculate Impact",
            comparisonTitle: "Personalized Comparison",
            metricHeader: "Metric",
            preTcjaHeader: "Pre-TCJA Law (2017)",
            currentLawHeader: "Current Law (2025)",
            obbbaHeader: "OBBBA (Post-Bill)",
            comparisonFootnote: "<strong>Why the Pre-TCJA comparison?</strong> Since the major provisions of the 2017 Tax Cuts and Jobs Act (TCJA) are set to expire, the Pre-TCJA law becomes the effective baseline for measuring the impact of new legislation.",
            evSolarNoteTitle: "<strong>Note:</strong>",
            evSolarNoteContent: "Under the OBBBA, the $7,500 EV tax credit and 30% residential solar credit are scheduled to expire after Dec 31, 2025. Future project costs may be higher.",
            deductionsRow: "Total Deductions",
            taxableIncomeRow: "Taxable Income",
            taxableIncomeTooltip: "Your income after all deductions. This is the amount your tax is calculated on.",
            ctcRow: "Child Tax Credit (CTC)",
            ctcTooltip: "A dollar-for-dollar reduction of your tax liability for each qualifying child.",
            taxLiabilityRow: "Est. Federal Tax Liability",
            taxLiabilityTooltip: "Your final estimated tax bill. Calculated as: (Tax on Taxable Income) - (Total Credits).",
            netSavingsRow: "Net Savings (vs. Pre-TCJA Law)",
            taxRateTitle: "Tax Rate Analysis",
            marginalRateLabel: "Marginal Tax Rate",
            marginalRateDesc: "The tax rate paid on the next dollar of taxable income.",
            averageRateLabel: "Average Effective Tax Rate",
            averageRateDesc: "The actual percentage of total income paid in federal tax.",
            disclaimerTitle: "âš ï¸ Important Disclaimer âš ï¸",
            disclaimerContent: "This tool provides simplified estimations for illustrative and educational purposes only. It is not a substitute for professional financial or tax advice. Tax laws are complex and subject to change. The OBBBA calculations are based on the latest available information and may not reflect the final version of the bill. Consult with a qualified professional before making any financial decisions.",
            footerDate: "Data based on public reports and CBO analysis as of July 4, 2025."
        };

        /**
         * Chinese content for the OBBBA Financial Impact Analyzer.
         */
        const zh = {
            headerTitle: "OBBBA å½±å“åˆ†æå™¨",
            headerSubtitle: "åˆ†æâ€œä¸€é¡¹ä¼Ÿå¤§æ³•æ¡ˆâ€çš„è´¢åŠ¡å½±å“ã€‚",
            langToggle: "English",
            summaryTitle: "è´¢æ”¿çŠ¶å†µæ£€æŸ¥ (10å¹´å±•æœ›)",
            kpiTaxCuts: "å‡ç¨",
            kpiSpendingReductions: "æ”¯å‡º<br>å‰Šå‡",
            kpiNetDebtIncrease: "å‡€å€ºåŠ¡å¢åŠ ",
            chartTitle: "è´¢æ”¿è¡ŒåŠ¨æ¯”è¾ƒ",
            breakdownTitle: "è¯¦ç»†åˆ†æ",
            faqDebtTitle: "å›½å€ºå¢åŠ çš„ç»æµå½±å“ï¼Ÿ",
            faqDebtContent: "å›½å€ºå¢åŠ å¯èƒ½å¯¼è‡´åˆ©ç‡ä¸Šå‡ï¼Œä»è€Œå¢åŠ æ¶ˆè´¹è€…å’Œä¼ä¸šçš„å€Ÿè´·æˆæœ¬ã€‚è¿™ä¹Ÿå¯èƒ½å¯¹ç¾å…ƒä»·å€¼æ„æˆä¸‹è¡Œå‹åŠ›å¹¶å¯¼è‡´é€šè´§è†¨èƒ€ï¼Œä»è€Œå¯èƒ½éšç€æ—¶é—´çš„æ¨ç§»é™ä½å®¶åº­è´­ä¹°åŠ›ã€‚",
            faqPersonalFinanceTitle: "å¯¹ä¸ªäººè´¢åŠ¡çš„é•¿æœŸå½±å“ï¼Ÿ",
            faqPersonalFinanceContent: "çŸ­æœŸçš„ç¨æ”¶èŠ‚çœå¯èƒ½ä¼šè¢«è´·æ¬¾åˆ©ç‡ä¸Šå‡ã€é€šè´§è†¨èƒ€ä»¥åŠå› è”é‚¦é¡¹ç›®å‰Šå‡å’Œæ¸…æ´èƒ½æºæ¿€åŠ±æªæ–½åºŸé™¤è€Œå¢åŠ çš„åŒ»ç–—å’Œèƒ½æºæˆæœ¬æ‰€æŠµæ¶ˆã€‚",
            faqEconomistsTitle: "é¡¶å°–ç»æµå­¦å®¶æ€ä¹ˆè¯´",
            quoteSummers: "â€œå¤§è§„æ¨¡ã€æ— èµ„é‡‘æ”¯æŒçš„å‡ç¨æ˜¯å¯¼è‡´é€šè´§è†¨èƒ€åŠ å‰§çš„æ ¹æºï¼Œæœ€ç»ˆå°†ä½¿åä»£èƒŒä¸Šä¸å¯æŒç»­çš„å€ºåŠ¡ã€‚â€",
            quoteSummersCite: "- æ‹‰é‡ŒÂ·è¨é»˜æ–¯",
            quoteLustig: "â€œæ”¿åºœå€ºåŠ¡çš„ä¾¿åˆ©æ”¶ç›Šç‡æ˜¯ä¸€ä¸ªå…³é”®æŒ‡æ ‡ã€‚åœ¨æ²¡æœ‰æ˜ç¡®å¿è¿˜è·¯å¾„çš„æƒ…å†µä¸‹å¤§å¹…å¢åŠ å€ºåŠ¡ä¾›ç»™çš„è´¢æ”¿æ”¿ç­–ï¼Œæœ‰å¯èƒ½ä¾µèš€è¿™ä¸€ä¼˜åŠ¿ï¼Œå¯¼è‡´æ”¿åºœèèµ„æˆæœ¬ä¸Šå‡ã€‚â€",
            quoteLustigCite: "- æ±‰è¯ºÂ·å¢æ–¯è’‚æ ¼",
            policyTitle: "ä¸»è¦æ”¿ç­–å˜åŒ–",
            glowUpsTitle: "åˆ©å¥½ (ç¨æ”¶ä¼˜æƒ )",
            saltDeductionTitle: "å·å’Œåœ°æ–¹ç¨ (SALT) æŠµå…ä¸Šé™æé«˜",
            saltDeductionDesc: "å¯¹äºAGIä¸º$500,000æˆ–ä»¥ä¸‹çš„çº³ç¨äººï¼Œä¸Šé™æé«˜åˆ°$40,000ã€‚å¯¹äºæ”¶å…¥è¾ƒé«˜è€…ï¼Œä¸Šé™æ¢å¤åˆ°$10,000ã€‚",
            childTaxCreditTitle: "å„¿ç«¥ç¨æ”¶æŠµå…å¢å¼º",
            childTaxCreditDesc: "æ¯åå„¿ç«¥çš„æŠµå…é¢ä»$2,000æ°¸ä¹…å¢åŠ åˆ°$2,200ã€‚",
            tipOvertimeTitle: "å°è´¹å’ŒåŠ ç­è´¹æŠµå…",
            tipOvertimeDesc: "ä¸ºå°è´¹å’ŒåŠ ç­è´¹çš„è”é‚¦æ‰€å¾—ç¨åˆ›å»ºäº†ä¸´æ—¶æŠµå…ã€‚",
            nerfsTitle: "å‰Šå¼± (æˆæœ¬å¢åŠ )",
            repealEnergyTitle: "åºŸé™¤èƒ½æºæŠµå…",
            repealEnergyDesc: "ç”µåŠ¨æ±½è½¦å’Œä½å®…å¤ªé˜³èƒ½è£…ç½®çš„è”é‚¦ç¨æ”¶æŠµå…è®¡åˆ’äº2025å¹´åç»“æŸã€‚",
            energyCostTitle: "é¢„è®¡èƒ½æºæˆæœ¬å¢åŠ ",
            energyCostDesc: "åˆ†æè¡¨æ˜ï¼Œå–æ¶ˆæ¸…æ´èƒ½æºæ¿€åŠ±æªæ–½å¯èƒ½å¯¼è‡´å®¶åº­å¹³å‡èƒ½æºæˆæœ¬ä¸Šå‡ã€‚",
            socialProgramsTitle: "å‰Šå‡ç¤¾ä¼šé¡¹ç›®",
            socialProgramsDesc: "Medicaidå’ŒSNAPèµ„æ ¼çš„å˜æ›´å¯èƒ½ä¼šå¢åŠ å—å½±å“å®¶åº­çš„è‡ªä»˜è´¹ç”¨ã€‚",
            calculatorTitle: "æ‚¨çš„ä¸ªäººå½±å“è®¡ç®—",
            calculatorSubtitle: "è¾“å…¥æ‚¨çš„ä¿¡æ¯ä»¥è·å¾—ä¸ªæ€§åŒ–ä¼°ç®—ã€‚",
            agiLabel: "è°ƒæ•´åæ€»æ”¶å…¥ (AGI)",
            stateLabel: "å±…ä½å·",
            stateTooltipTitle: "è¿™ä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ",
            stateTooltipContent: "2017å¹´çš„TCJAå¯¹å·å’Œåœ°æ–¹ç¨ï¼ˆSALTï¼‰çš„æŠµå…ä¸Šé™è®¾å®šä¸º$10kï¼Œè¿™ä¸»è¦å½±å“äº†é«˜ç¨æ”¶å·çš„å±…æ°‘ã€‚OBBBAæš‚æ—¶æé«˜äº†è¿™ä¸€ä¸Šé™ï¼Œä¸ºè¿™äº›å·çš„å±…æ°‘æä¾›äº†æ˜¾è‘—çš„ç›´æ¥æ•‘æµï¼Œè€Œå¯¹ä½ç¨æ”¶å·çš„å½±å“å¾ˆå°ã€‚",
            filingStatusLabel: "æŠ¥ç¨èº«ä»½",
            filingStatusSingle: "å•èº«",
            filingStatusMfj: "å¤«å¦»è”åˆæŠ¥ç¨",
            advancedOptions: "é«˜çº§é€‰é¡¹",
            childrenLabel: "å­å¥³æ•°é‡ (17å²ä»¥ä¸‹)",
            propertyTaxLabel: "å¹´åº¦æˆ¿äº§ç¨",
            overtimeLabel: "å¹´åº¦åŠ ç­æ”¶å…¥",
            overtimeDesc: "OBBBA æŠµå…ä¸Šé™ï¼šå•èº«$12.5k / è”åˆ$25kã€‚",
            tipsLabel: "å¹´åº¦å°è´¹æ”¶å…¥",
            tipsDesc: "OBBBA æŠµå…ä¸Šé™ï¼š$25kã€‚",
            evSolarLabel: "æˆ‘è®¡åˆ’åœ¨2025å¹´åè¿›è¡Œç”µåŠ¨æ±½è½¦æˆ–å¤ªé˜³èƒ½å‡çº§ã€‚",
            calculateButton: "è®¡ç®—å½±å“",
            comparisonTitle: "ä¸ªæ€§åŒ–æ¯”è¾ƒ",
            metricHeader: "æŒ‡æ ‡",
            preTcjaHeader: "TCJAå‰æ³•å¾‹ (2017)",
            currentLawHeader: "ç°è¡Œæ³•å¾‹ (2025)",
            obbbaHeader: "OBBBA (æ³•æ¡ˆå)",
            comparisonFootnote: "<strong>ä¸ºä»€ä¹ˆè¦ä¸TCJAå‰çš„æ³•å¾‹æ¯”è¾ƒï¼Ÿ</strong> ç”±äº2017å¹´ã€Šå‡ç¨ä¸å°±ä¸šæ³•æ¡ˆã€‹(TCJA) çš„ä¸»è¦æ¡æ¬¾å³å°†åˆ°æœŸï¼ŒTCJAå‰çš„æ³•å¾‹æˆä¸ºè¡¡é‡æ–°ç«‹æ³•å½±å“çš„æœ‰æ•ˆåŸºå‡†ã€‚",
            evSolarNoteTitle: "<strong>æ³¨æ„:</strong>",
            evSolarNoteContent: "æ ¹æ®OBBBAï¼Œä»·å€¼$7,500çš„ç”µåŠ¨æ±½è½¦ç¨æ”¶æŠµå…å’Œ30%çš„ä½å®…å¤ªé˜³èƒ½æŠµå…è®¡åˆ’äº2025å¹´12æœˆ31æ—¥ååˆ°æœŸã€‚æœªæ¥çš„é¡¹ç›®æˆæœ¬å¯èƒ½ä¼šæ›´é«˜ã€‚",
            deductionsRow: "æ€»æŠµå…é¢",
            taxableIncomeRow: "åº”ç¨æ”¶å…¥",
            taxableIncomeTooltip: "æ‰£é™¤æ‰€æœ‰å¯æŠµå…é¡¹ç›®åçš„æ”¶å…¥ã€‚æ‚¨çš„ç¨æ¬¾æ˜¯æ ¹æ®è¿™ä¸ªæ•°é¢è®¡ç®—çš„ã€‚",
            ctcRow: "å„¿ç«¥ç¨æ”¶æŠµå… (CTC)",
            ctcTooltip: "ä¸ºæ¯ä¸ªç¬¦åˆæ¡ä»¶çš„å­å¥³æä¾›çš„é€å…ƒå‡ç¨ã€‚",
            taxLiabilityRow: "é¢„ä¼°è”é‚¦åº”çº³ç¨é¢",
            taxLiabilityTooltip: "æ‚¨çš„æœ€ç»ˆé¢„ä¼°ç¨å•ã€‚è®¡ç®—å…¬å¼ä¸ºï¼šï¼ˆåº”ç¨æ”¶å…¥çš„ç¨æ¬¾ï¼‰-ï¼ˆæ€»æŠµå…é¢ï¼‰ã€‚",
            netSavingsRow: "å‡€èŠ‚çœ (ä¸TCJAå‰æ³•å¾‹ç›¸æ¯”)",
            taxRateTitle: "ç¨ç‡åˆ†æ",
            marginalRateLabel: "è¾¹é™…ç¨ç‡",
            marginalRateDesc: "ä¸‹ä¸€ç¾å…ƒåº”ç¨æ”¶å…¥æ‰€æ”¯ä»˜çš„ç¨ç‡ã€‚",
            averageRateLabel: "å¹³å‡æœ‰æ•ˆç¨ç‡",
            averageRateDesc: "æ€»æ”¶å…¥ä¸­å®é™…æ”¯ä»˜çš„è”é‚¦ç¨ç™¾åˆ†æ¯”ã€‚",
            disclaimerTitle: "âš ï¸ é‡è¦å…è´£å£°æ˜ âš ï¸",
            disclaimerContent: "æœ¬å·¥å…·ä»…ä¸ºè¯´æ˜å’Œæ•™è‚²ç›®çš„æä¾›ç®€åŒ–ä¼°ç®—ã€‚å®ƒä¸èƒ½æ›¿ä»£ä¸“ä¸šçš„è´¢åŠ¡æˆ–ç¨åŠ¡å»ºè®®ã€‚ç¨æ³•å¤æ‚ä¸”å¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚OBBBAçš„è®¡ç®—åŸºäºæœ€æ–°å¯ç”¨ä¿¡æ¯ï¼Œå¯èƒ½ä¸åæ˜ æ³•æ¡ˆçš„æœ€ç»ˆç‰ˆæœ¬ã€‚åœ¨åšå‡ºä»»ä½•è´¢åŠ¡å†³å®šä¹‹å‰ï¼Œè¯·å’¨è¯¢åˆæ ¼çš„ä¸“ä¸šäººå£«ã€‚",
            footerDate: "æ•°æ®åŸºäºæˆªè‡³2025å¹´7æœˆ4æ—¥çš„å…¬å¼€æŠ¥å‘Šå’ŒCBOåˆ†æã€‚"
        };
    </script>

    <style>
        /* Bold & Retro "Memphis" Style v6 */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0f0f0;
            color: #000000; 
        }
        h1, h2, .heading-font-main {
            font-family: 'Anton', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        h3, .heading-font-script {
             font-family: 'Kalam', cursive;
        }
        .retro-card {
            background-color: white;
            border: 3px solid #000000;
            padding: 1.5rem;
            position: relative;
        }
        .retro-card::after {
            content: '';
            position: absolute;
            top: 12px;
            left: 12px;
            right: -12px;
            bottom: -12px;
            background-color: #FFD100; /* Yellow */
            z-index: -1;
            border: 3px solid #000;
        }
        .policy-card {
            background-color: white;
            border: 3px solid #000000;
            padding: 1.5rem;
            position: relative;
        }
        .policy-card::after {
            content: '';
            position: absolute;
            top: 12px;
            left: 12px;
            right: -12px;
            bottom: -12px;
            background-image: repeating-linear-gradient(45deg, black, black 4px, white 4px, white 8px);
            z-index: -1;
            border: 3px solid #000;
        }
        .dot-pattern {
            background-image: radial-gradient(black 1px, transparent 1px);
            background-size: 15px 15px;
        }
        .full-width-pattern-section {
            background-color: #00EAD3;
            background-image: repeating-linear-gradient(45deg, #00c7b2 25%, transparent 25%, transparent 75%, #00c7b2 75%, #00c7b2), repeating-linear-gradient(-45deg, #00c7b2 25%, transparent 25%, transparent 75%, #00c7b2 75%, #00c7b2);
            background-position: 0 0, 15px 15px;
            background-size: 30px 30px;
            padding-top: 4rem;
            padding-bottom: 4rem;
            margin-left: calc(50% - 50vw);
            margin-right: calc(50% - 50vw);
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        .kpi-value {
            font-size: clamp(2.5rem, 6vw, 4rem);
            line-height: 1;
            font-family: 'Anton', sans-serif;
        }
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #000;
            border-radius: 0;
            background-color: #ffffff;
            color: #000;
            transition: all 0.2s;
            font-weight: 600;
        }
        .form-input:focus {
            outline: none;
            box-shadow: 0 0 0 3px #FF00A5; /* Magenta */
        }
        .form-label {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
            color: #000;
        }
        details > summary {
            cursor: pointer;
            font-weight: 700;
            color: #000;
            list-style: none;
            padding: 1rem;
            background-color: #00EAD3; /* Cyan */
            border: 2px solid #000;
            transition: background-color 0.2s;
        }
        details > summary:hover {
            background-color: #00c7b2;
        }
        details[open] > summary {
             background-color: #00c7b2;
        }
        details .faq-content {
            padding: 1rem;
            background-color: #ffffff;
            border: 2px solid #000;
            border-top: none;
            font-size: 0.9rem;
            color: #333;
        }
        .details-small > summary {
            padding: 0.5rem 1rem;
            font-weight: 600;
            font-size: 0.75rem;
            border: 2px solid #000;
            background-color: #FFD100;
            color: #000;
        }
        .details-small[open] > summary {
            background-color: #e6bb00;
        }
        .details-small .faq-content {
            font-size: 0.75rem;
            background-color: #fff;
            color: #333;
            border-color: #000;
        }
        .comparison-table td, .comparison-table th {
            padding: 1rem 0.75rem;
            text-align: left;
            vertical-align: middle;
            border-bottom: 2px solid #000;
        }
        .comparison-table th {
            background-color: #FFD100;
            color: #000;
        }
        .info-icon {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            position: relative;
            width: 1.2rem;
            height: 1.2rem;
            border-radius: 50%;
            background-color: #000;
            color: white;
            font-family: serif;
            font-style: italic;
            font-size: 0.8rem;
            font-weight: bold;
            cursor: pointer;
            margin-left: 4px;
        }
        .info-icon .tooltip-text {
            visibility: hidden;
            width: 240px;
            background-color: #000;
            color: #fff;
            text-align: center;
            border-radius: 4px;
            border: 2px solid #fff;
            padding: 8px;
            position: absolute;
            z-index: 10;
            bottom: 125%;
            left: 50%;
            margin-left: -120px;
            opacity: 0;
            transition: opacity 0.3s;
            font-family: 'Poppins', sans-serif;
            font-size: 0.75rem;
            font-weight: normal;
            line-height: 1.4;
        }
        .info-icon:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        .main-button {
            background-color: #FF00A5;
            color: white;
            border: 3px solid #000;
            box-shadow: 6px 6px 0px #000;
            transition: all 0.2s;
        }
        .main-button:hover {
            box-shadow: 3px 3px 0px #000;
            transform: translate(3px, 3px);
        }
        .chart-title {
            position: relative;
            z-index: 1;
        }
    </style>
</head>
<body class="antialiased overflow-x-hidden">

    <header class="text-center py-20 px-4 bg-[#FFD100] border-b-4 border-black relative">
        <h1 data-i18n="headerTitle" class="text-5xl md:text-8xl font-bold mb-3 text-black"></h1>
        <p data-i18n="headerSubtitle" class="text-lg md:text-xl max-w-3xl mx-auto text-gray-800 font-semibold"></p>
        <button id="lang-toggle" data-i18n="langToggle" class="absolute top-4 right-4 bg-black text-white py-2 px-4 font-semibold hover:bg-gray-800 transition-colors"></button>
    </header>

    <main class="container mx-auto p-4 md:p-8 space-y-20">

        <section id="summary">
            <h2 data-i18n="summaryTitle" class="text-4xl font-bold text-center mb-12"></h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-12 items-center">
                <div class="retro-card text-center dot-pattern">
                    <h3 data-i18n="kpiTaxCuts" class="text-2xl heading-font-script font-bold text-gray-800 mb-2 bg-white inline-block px-2"></h3>
                    <p class="kpi-value text-red-500">-$4.5T</p>
                </div>
                 <div class="retro-card text-center">
                    <h3 data-i18n="kpiSpendingReductions" class="text-2xl heading-font-script font-bold text-gray-800 mb-2 text-center"></h3>
                    <p class="kpi-value text-green-500">+$1.2T</p>
                </div>
                <div class="retro-card text-center dot-pattern">
                    <h3 data-i18n="kpiNetDebtIncrease" class="text-2xl heading-font-script font-bold text-gray-800 mb-2 bg-white inline-block px-2"></h3>
                    <p class="kpi-value text-orange-500">-$3.3T</p>
                </div>
            </div>
             <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 mt-16 items-start">
                 <div class="retro-card p-6 text-center">
                    <h3 data-i18n="chartTitle" class="text-2xl font-bold text-gray-800 mb-4 bg-white inline-block px-2 chart-title heading-font-script"></h3>
                    <div class="chart-container">
                        <canvas id="fiscalImpactChart"></canvas>
                    </div>
                </div>
                <div class="space-y-4 pt-4 lg:pt-0">
                    <h2 data-i18n="breakdownTitle" class="text-3xl font-bold text-center mb-4"></h2>
                     <details>
                        <summary data-i18n="faqDebtTitle"></summary>
                        <div class="faq-content">
                            <p data-i18n="faqDebtContent"></p>
                        </div>
                    </details>
                    <details>
                        <summary data-i18n="faqPersonalFinanceTitle"></summary>
                        <div class="faq-content">
                            <p data-i18n="faqPersonalFinanceContent"></p>
                        </div>
                    </details>
                     <details>
                        <summary data-i18n="faqEconomistsTitle"></summary>
                        <div class="faq-content space-y-4">
                            <blockquote class="border-l-4 border-black pl-4">
                                <p data-i18n="quoteSummers" class="italic"></p>
                                <cite data-i18n="quoteSummersCite" class="block text-right not-italic text-sm font-semibold mt-2"></cite>
                            </blockquote>
                             <blockquote class="border-l-4 border-black pl-4">
                                <p data-i18n="quoteLustig" class="italic"></p>
                                <cite data-i18n="quoteLustigCite" class="block text-right not-italic text-sm font-semibold mt-2"></cite>
                            </blockquote>
                        </div>
                    </details>
                </div>
            </div>
        </section>

        <section id="policy-details">
            <h2 data-i18n="policyTitle" class="text-4xl font-bold text-center mb-8"></h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                <div class="policy-card">
                    <h3 data-i18n="glowUpsTitle" class="text-2xl font-bold text-gray-800 mb-4 heading-font-script"></h3>
                    <ul class="space-y-4">
                        <li class="flex items-start"><span class="text-2xl mr-4">ğŸ‘</span><div><strong data-i18n="saltDeductionTitle" class="font-semibold"></strong><br><span data-i18n="saltDeductionDesc" class="text-sm text-slate-600"></span></div></li>
                        <li class="flex items-start"><span class="text-2xl mr-4">ğŸ‘</span><div><strong data-i18n="childTaxCreditTitle" class="font-semibold"></strong><br><span data-i18n="childTaxCreditDesc" class="text-sm text-slate-600"></span></div></li>
                         <li class="flex items-start"><span class="text-2xl mr-4">ğŸ‘</span><div><strong data-i18n="tipOvertimeTitle" class="font-semibold"></strong><br><span data-i18n="tipOvertimeDesc" class="text-sm text-slate-600"></span></div></li>
                    </ul>
                </div>
                <div class="policy-card">
                    <h3 data-i18n="nerfsTitle" class="text-2xl font-bold text-gray-800 mb-4 heading-font-script"></h3>
                    <ul class="space-y-4">
                        <li class="flex items-start"><span class="text-2xl mr-4">ğŸ‘</span><div><strong data-i18n="repealEnergyTitle" class="font-semibold"></strong><br><span data-i18n="repealEnergyDesc" class="text-sm text-slate-600"></span></div></li>
                         <li class="flex items-start"><span class="text-2xl mr-4">ğŸ‘</span><div><strong data-i18n="energyCostTitle" class="font-semibold"></strong><br><span data-i18n="energyCostDesc" class="text-sm text-slate-600"></span></div></li>
                         <li class="flex items-start"><span class="text-2xl mr-4">ğŸ‘</span><div><strong data-i18n="socialProgramsTitle" class="font-semibold"></strong><br><span data-i18n="socialProgramsDesc" class="text-sm text-slate-600"></span></div></li>
                    </ul>
                </div>
            </div>
        </section>

        <div class="full-width-pattern-section">
            <section id="calculator" class="retro-card p-8 container mx-auto">
                <h2 data-i18n="calculatorTitle" class="text-4xl font-bold text-center text-black mb-2 bg-white inline-block px-2"></h2>
                <p data-i18n="calculatorSubtitle" class="text-center text-gray-700 mb-8 bg-white inline-block px-2"></p>
                <form id="impact-form" class="max-w-3xl mx-auto space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="agi" data-i18n="agiLabel" class="form-label"></label>
                            <input type="number" id="agi" class="form-input" placeholder="e.g., 85000" required>
                        </div>
                        <div>
                            <label for="state" data-i18n="stateLabel" class="form-label"></label>
                            <select id="state" class="form-input" required></select>
                            <details class="details-small mt-2">
                                <summary data-i18n="stateTooltipTitle"></summary>
                                <div class="faq-content">
                                    <p data-i18n="stateTooltipContent"></p>
                                </div>
                            </details>
                        </div>
                    </div>
                    <div>
                        <label data-i18n="filingStatusLabel" class="form-label"></label>
                        <div class="flex gap-4 items-center">
                            <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="filingStatus" value="single" class="h-5 w-5 text-black focus:ring-black" checked> <span data-i18n="filingStatusSingle"></span></label>
                            <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="filingStatus" value="mfj" class="h-5 w-5 text-black focus:ring-black"> <span data-i18n="filingStatusMfj"></span></label>
                        </div>
                    </div>

                    <details class="pt-4">
                        <summary data-i18n="advancedOptions" class="heading-font-script text-lg"></summary>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4 p-4 bg-white border-2 border-black">
                            <div>
                                <label for="children" data-i18n="childrenLabel" class="form-label"></label>
                                <input type="number" id="children" class="form-input" placeholder="0" value="0">
                            </div>
                            <div>
                                <label for="property-tax" data-i18n="propertyTaxLabel" class="form-label"></label>
                                <input type="number" id="property-tax" class="form-input" placeholder="e.g., 4500" value="0">
                            </div>
                            <div>
                                <label for="overtime" data-i18n="overtimeLabel" class="form-label"></label>
                                <input type="number" id="overtime" class="form-input" placeholder="e.g., 5000" value="0">
                                <p data-i18n="overtimeDesc" class="text-xs text-slate-500 mt-1"></p>
                            </div>
                            <div>
                                <label for="tips" data-i18n="tipsLabel" class="form-label"></label>
                                <input type="number" id="tips" class="form-input" placeholder="e.g., 10000" value="0">
                                <p data-i18n="tipsDesc" class="text-xs text-slate-500 mt-1"></p>
                            </div>
                            <div class="md:col-span-2">
                                <label class="flex items-center gap-2 cursor-pointer text-sm text-slate-600">
                                    <input type="checkbox" id="ev-solar" class="h-4 w-4 rounded text-black focus:ring-black">
                                    <span data-i18n="evSolarLabel"></span>
                                </label>
                            </div>
                        </div>
                    </details>
                    
                    <div class="text-center pt-6">
                        <button type="submit" data-i18n="calculateButton" class="main-button font-bold py-3 px-8 text-lg heading-font-main"></button>
                    </div>
                </form>
            </section>
        </div>
        
        <section id="comparison-output" class="hidden">
             <h2 data-i18n="comparisonTitle" class="text-4xl font-bold text-center text-black mb-8"></h2>
             <div class="retro-card p-4 md:p-8" style="--card-color: #00EAD3;">
                 <div class="overflow-x-auto">
                    <table class="w-full text-sm md:text-base comparison-table">
                        <thead>
                            <tr>
                                <th data-i18n="metricHeader" class="w-1/4"></th>
                                <th data-i18n="preTcjaHeader" class="w-1/4 text-center"></th>
                                <th data-i18n="currentLawHeader" class="w-1/4 text-center"></th>
                                <th data-i18n="obbbaHeader" class="w-1/4 text-center"></th>
                            </tr>
                        </thead>
                        <tbody id="comparison-body">
                        </tbody>
                    </table>
                 </div>
                 <div data-i18n="comparisonFootnote" class="mt-4 p-4 bg-gray-100 border-2 border-dashed border-black text-sm">
                 </div>
                 <div id="ev-solar-note" class="hidden mt-6 p-4 bg-yellow-100 text-yellow-800 border-2 border-black">
                    <p><span data-i18n="evSolarNoteTitle"></span> <span data-i18n="evSolarNoteContent"></span></p>
                 </div>
             </div>
        </section>

        <section id="tax-rate-explanation" class="hidden">
             <div class="retro-card mt-8 p-6">
                 <h3 data-i18n="taxRateTitle" class="text-2xl font-bold text-center text-black mb-4 heading-font-script"></h3>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-center">
                     <div>
                         <h4 data-i18n="marginalRateLabel" class="font-semibold text-gray-700"></h4>
                         <p id="marginal-rate-output" class="text-xl md:text-2xl font-bold text-black">--% | --% | --%</p>
                         <p data-i18n="marginalRateDesc" class="text-sm text-slate-500 mt-2"></p>
                     </div>
                      <div>
                         <h4 data-i18n="averageRateLabel" class="font-semibold text-gray-700"></h4>
                         <p id="average-rate-output" class="text-xl md:text-2xl font-bold text-black">--% | --% | --%</p>
                         <p data-i18n="averageRateDesc" class="text-sm text-slate-500 mt-2"></p>
                     </div>
                 </div>
             </div>
        </section>

    </main>
    
    <footer class="text-center mt-16 py-8 px-4 border-t-4 border-black bg-white">
        <div class="max-w-4xl mx-auto p-4 bg-red-100 text-red-800 border-2 border-black">
             <p data-i18n="disclaimerTitle" class="font-bold text-lg"></p>
             <p data-i18n="disclaimerContent" class="text-sm mt-2"></p>
        </div>
        <p data-i18n="footerDate" class="text-slate-500 text-sm mt-8"></p>
    </footer>

    <!-- Coded by zZyan | github.com/zZyan -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- I18n and Content Logic ---
            let currentLang = 'en';
            const elements = document.querySelectorAll('[data-i18n]');

            function updateUI(lang) {
                // The 'en' and 'zh' objects are now in the global scope from the script tags in the <head>
                const i18nData = lang === 'en' ? en : zh;
                
                elements.forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (i18nData[key]) {
                        // For elements that might contain child elements (like spans), it's safer to just set textContent of the parent.
                        // However, since some of our content has <br> or <strong>, innerHTML is necessary here.
                        el.innerHTML = i18nData[key];
                    }
                });
                document.documentElement.lang = lang;
            }

            const langToggle = document.getElementById('lang-toggle');
            langToggle.addEventListener('click', () => {
                currentLang = currentLang === 'en' ? 'zh' : 'en';
                updateUI(currentLang);
                // We need to re-run calculation if results are visible to update table headers/labels
                 if (document.getElementById('comparison-output').style.display === 'block'){
                     // The preventDefault is not strictly needed here but it's good practice for programmatic submissions.
                     document.getElementById('impact-form').dispatchEvent(new Event('submit', { cancelable: true }));
                 }
            });


            // --- Calculator Logic ---
            const fiscalImpactCanvas = document.getElementById('fiscalImpactChart');
            if (fiscalImpactCanvas) {
                const fiscalImpactCtx = fiscalImpactCanvas.getContext('2d');
                Chart.defaults.color = '#000000';
                Chart.defaults.font.family = "'Poppins', sans-serif";
                new Chart(fiscalImpactCtx, { type: 'bar', data: { labels: ['Spending Reductions', 'Tax Cuts'], datasets: [{ label: '10-Year Fiscal Impact', data: [1.2, -4.5], backgroundColor: (context) => { const value = context.dataset.data[context.dataIndex]; return value > 0 ? '#00EAD3' : '#FF00A5'; }, borderWidth: 2, borderColor: '#000', }] }, options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', scales: { x: { grid: { color: '#e0e0e0' }, ticks: { callback: function(value) { return `$${value}T`; }, color: '#000' }, title: { display: true, text: 'Impact in Trillions of Dollars', font: { weight: '700', size: 14 } } }, y: { grid: { display: false }, ticks: { color: '#000' } } }, plugins: { legend: { display: false }, tooltip: { backgroundColor: '#000', titleColor: '#fff', bodyColor: '#eee', callbacks: { label: function(context) { return `${context.label}: $${context.raw} Trillion`; } } } } } });
            }

            const states = { "AL": 0.05, "AK": 0, "AZ": 0.025, "AR": 0.049, "CA": 0.093, "CO": 0.044, "CT": 0.055, "DE": 0.066, "FL": 0, "GA": 0.0549, "HI": 0.0825, "ID": 0.058, "IL": 0.0495, "IN": 0.0315, "IA": 0.057, "KS": 0.057, "KY": 0.045, "LA": 0.0425, "ME": 0.0715, "MD": 0.0575, "MA": 0.05, "MI": 0.0425, "MN": 0.0785, "MS": 0.05, "MO": 0.0495, "MT": 0.0675, "NE": 0.0664, "NV": 0, "NH": 0, "NJ": 0.0897, "NM": 0.059, "NY": 0.0685, "NC": 0.0475, "ND": 0.025, "OH": 0.0399, "OK": 0.0475, "OR": 0.099, "PA": 0.0307, "RI": 0.0599, "SC": 0.065, "SD": 0, "TN": 0, "TX": 0, "UT": 0.0485, "VT": 0.0875, "VA": 0.0575, "WA": 0, "WV": 0.0512, "WI": 0.0765, "WY": 0 };
            const stateSelect = document.getElementById('state');
            Object.keys(states).forEach(key => { const option = document.createElement('option'); option.value = key; option.textContent = key; stateSelect.appendChild(option); });
            stateSelect.value = "CA";
            const taxBrackets2017 = { single: [ { rate: 0.10, min: 0, max: 9325 }, { rate: 0.15, min: 9325, max: 37950 }, { rate: 0.25, min: 37950, max: 91900 }, { rate: 0.28, min: 91900, max: 191650 }, { rate: 0.33, min: 191650, max: 416700 }, { rate: 0.35, min: 416700, max: 418400 }, { rate: 0.396, min: 418400, max: Infinity } ], mfj: [ { rate: 0.10, min: 0, max: 18650 }, { rate: 0.15, min: 18650, max: 75900 }, { rate: 0.25, min: 75900, max: 153100 }, { rate: 0.28, min: 153100, max: 233350 }, { rate: 0.33, min: 233350, max: 416700 }, { rate: 0.35, min: 416700, max: 470700 }, { rate: 0.396, min: 470700, max: Infinity } ] };
            const taxBrackets2025 = { single: [ { rate: 0.10, min: 0, max: 11925 }, { rate: 0.12, min: 11925, max: 48475 }, { rate: 0.22, min: 48475, max: 103350 }, { rate: 0.24, min: 103350, max: 197300 }, { rate: 0.32, min: 197300, max: 250525 }, { rate: 0.35, min: 250525, max: 626350 }, { rate: 0.37, min: 626350, max: Infinity } ], mfj: [ { rate: 0.10, min: 0, max: 23850 }, { rate: 0.12, min: 23850, max: 96950 }, { rate: 0.22, min: 96950, max: 206700 }, { rate: 0.24, min: 206700, max: 394600 }, { rate: 0.32, min: 394600, max: 501050 }, { rate: 0.35, min: 501050, max: 751600 }, { rate: 0.37, min: 751600, max: Infinity } ] };
            const standardDeductions = { preTCJA: { single: 6350, mfj: 12700 }, current: { single: 15000, mfj: 30000 }, obbba: { single: 15750, mfj: 31500 } };
            const personalExemption2017 = 4050;
            function calculateTax(income, filingStatus, brackets) { let tax = 0; let remainingIncome = income; for (const bracket of brackets[filingStatus]) { if (remainingIncome > bracket.min) { const taxableInBracket = Math.min(remainingIncome, bracket.max) - bracket.min; tax += taxableInBracket * bracket.rate; } } return tax > 0 ? tax : 0; }
            function formatCurrency(amount) { return amount.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 }); }
            function createInfoIcon(tooltipText) { return `<div class="info-icon">?<span class="tooltip-text">${tooltipText}</span></div>`; }
            
            document.getElementById('impact-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const agi = parseFloat(document.getElementById('agi').value) || 0;
                const state = document.getElementById('state').value;
                const filingStatus = document.querySelector('input[name="filingStatus"]:checked').value;
                const children = parseInt(document.getElementById('children').value) || 0;
                const propertyTax = parseFloat(document.getElementById('property-tax').value) || 0;
                const overtime = parseFloat(document.getElementById('overtime').value) || 0;
                const tips = parseFloat(document.getElementById('tips').value) || 0;
                const planningEV = document.getElementById('ev-solar').checked;
                const stateTaxRate = states[state];
                const stateIncomeTax = agi * stateTaxRate;
                const totalSaltPaid = stateIncomeTax + propertyTax;
                const results = { preTCJA: {}, current: {}, obbba: {} };
                const i18nData = currentLang === 'en' ? en : zh;
                
                const standardDed2017 = standardDeductions.preTCJA[filingStatus];
                const itemizedDed2017 = totalSaltPaid;
                const totalDed2017 = Math.max(standardDed2017, itemizedDed2017);
                const exemptionsValue2017 = (filingStatus === 'single' ? 1 + children : 2 + children) * personalExemption2017;
                results.preTCJA.totalDeductions = totalDed2017 + exemptionsValue2017;
                results.preTCJA.taxableIncome = Math.max(0, agi - results.preTCJA.totalDeductions);
                const taxLiability2017 = calculateTax(results.preTCJA.taxableIncome, filingStatus, taxBrackets2017);
                const ctcThreshold2017 = filingStatus === 'single' ? 75000 : 110000;
                const ctcPhaseOut2017 = Math.floor(Math.max(0, agi - ctcThreshold2017) / 1000) * 50;
                results.preTCJA.ctc = Math.max(0, (children * 1000) - ctcPhaseOut2017);
                results.preTCJA.finalTax = Math.max(0, taxLiability2017 - results.preTCJA.ctc);

                const standardDedCurrent = standardDeductions.current[filingStatus];
                const saltDedCurrent = Math.min(totalSaltPaid, 10000);
                results.current.totalDeductions = Math.max(standardDedCurrent, saltDedCurrent);
                results.current.taxableIncome = Math.max(0, agi - results.current.totalDeductions);
                const taxLiabilityCurrent = calculateTax(results.current.taxableIncome, filingStatus, taxBrackets2025);
                results.current.ctc = children * 2000;
                results.current.finalTax = Math.max(0, taxLiabilityCurrent - results.current.ctc);

                const overtimeDedCap = filingStatus === 'single' ? 12500 : 25000;
                const tipDedCap = 25000;
                let overtimeDed = Math.min(overtime, overtimeDedCap);
                let tipDed = Math.min(tips, tipDedCap);
                const specialIncomePhaseoutThreshold = filingStatus === 'single' ? 150000 : 300000;
                if(agi > specialIncomePhaseoutThreshold){ overtimeDed = 0; tipDed = 0; }
                const specialDedAfter = overtimeDed + tipDed;
                const agiAfterSpecialDeds = agi - specialDedAfter;

                const phaseoutThreshold = 500000;
                let saltCapAfter = (agi <= phaseoutThreshold) ? 40000 : 10000;

                const saltDedAfter = Math.min(totalSaltPaid, saltCapAfter);
                const standardDedAfter = standardDeductions.obbba[filingStatus];
                results.obbba.totalDeductions = Math.max(standardDedAfter, saltDedAfter);
                
                results.obbba.taxableIncome = Math.max(0, agiAfterSpecialDeds - results.obbba.totalDeductions);
                const taxLiabilityAfter = calculateTax(results.obbba.taxableIncome, filingStatus, taxBrackets2025);
                results.obbba.ctc = children * 2200;
                results.obbba.finalTax = Math.max(0, taxLiabilityAfter - results.obbba.ctc);
                
                const tooltipPreTCJA = `Max(${formatCurrency(standardDed2017)}, ${formatCurrency(itemizedDed2017)}) + ${formatCurrency(exemptionsValue2017)} (Exemptions)`;
                const tooltipCurrent = `Max(Std Ded ${formatCurrency(standardDedCurrent)}, SALT Ded ${formatCurrency(saltDedCurrent)})`;
                const tooltipOBBBA = `Max(Std Ded ${formatCurrency(standardDedAfter)}, SALT Ded ${formatCurrency(saltCapAfter.toFixed(0))})`;

                const comparisonBody = document.getElementById('comparison-body');
                comparisonBody.innerHTML = `
                    <tr>
                        <td>${i18nData.deductionsRow}</td>
                        <td class="text-center">${formatCurrency(results.preTCJA.totalDeductions)} ${createInfoIcon(tooltipPreTCJA)}</td>
                        <td class="text-center">${formatCurrency(results.current.totalDeductions)} ${createInfoIcon(tooltipCurrent)}</td>
                        <td class="text-center font-semibold">${formatCurrency(results.obbba.totalDeductions)} ${createInfoIcon(tooltipOBBBA)}</td>
                    </tr>
                    <tr>
                        <td>${i18nData.taxableIncomeRow} ${createInfoIcon(i18nData.taxableIncomeTooltip)}</td>
                        <td class="text-center">${formatCurrency(results.preTCJA.taxableIncome)}</td>
                        <td class="text-center">${formatCurrency(results.current.taxableIncome)}</td>
                        <td class="text-center font-semibold">${formatCurrency(results.obbba.taxableIncome)}</td>
                    </tr>
                    <tr>
                        <td>${i18nData.ctcRow} ${createInfoIcon(i18nData.ctcTooltip)}</td>
                        <td class="text-center">${formatCurrency(results.preTCJA.ctc)}</td>
                        <td class="text-center">${formatCurrency(results.current.ctc)}</td>
                        <td class="text-center font-semibold">${formatCurrency(results.obbba.ctc)}</td>
                    </tr>
                    <tr class="font-bold bg-gray-200">
                        <td>${i18nData.taxLiabilityRow} ${createInfoIcon(i18nData.taxLiabilityTooltip)}</td>
                        <td class="text-center">${formatCurrency(results.preTCJA.finalTax)}</td>
                        <td class="text-center">${formatCurrency(results.current.finalTax)}</td>
                        <td class="text-center">${formatCurrency(results.obbba.finalTax)}</td>
                    </tr>
                    <tr class="text-xl font-bold bg-green-200 text-green-800">
                        <td>${i18nData.netSavingsRow}</td>
                        <td colspan="3" class="text-center">${formatCurrency(results.preTCJA.finalTax - results.obbba.finalTax)}</td>
                    </tr>
                `;

                document.getElementById('ev-solar-note').style.display = planningEV ? 'block' : 'none';
                document.getElementById('comparison-output').style.display = 'block';
                function getMarginalRate(income, filingStatus, brackets) { for (const bracket of brackets[filingStatus]) { if (income <= bracket.max) return bracket.rate; } return brackets[filingStatus][brackets[filingStatus].length - 1].rate; }
                const marginalRatePreTCJA = getMarginalRate(results.preTCJA.taxableIncome, filingStatus, taxBrackets2017) * 100;
                const marginalRateCurrent = getMarginalRate(results.current.taxableIncome, filingStatus, taxBrackets2025) * 100;
                const marginalRateOBBBA = getMarginalRate(results.obbba.taxableIncome, filingStatus, taxBrackets2025) * 100;
                const avgEffectiveRatePreTCJA = agi > 0 ? (results.preTCJA.finalTax / agi) * 100 : 0;
                const avgEffectiveRateCurrent = agi > 0 ? (results.current.finalTax / agi) * 100 : 0;
                const avgEffectiveRateOBBBA = agi > 0 ? (results.obbba.finalTax / agi) * 100 : 0;
                document.getElementById('marginal-rate-output').innerHTML = `<span class="text-gray-500">${marginalRatePreTCJA.toFixed(1)}%</span> | <span class="text-gray-500">${marginalRateCurrent.toFixed(1)}%</span> | <span class="text-black">${marginalRateOBBBA.toFixed(1)}%</span>`;
                document.getElementById('average-rate-output').innerHTML = `<span class="text-gray-500">${avgEffectiveRatePreTCJA.toFixed(2)}%</span> | <span class="text-gray-500">${avgEffectiveRateCurrent.toFixed(2)}%</span> | <span class="text-black">${avgEffectiveRateOBBBA.toFixed(2)}%</span>`;
                document.getElementById('tax-rate-explanation').style.display = 'block';
                document.getElementById('comparison-output').scrollIntoView({ behavior: 'smooth' });
            });

            // Initial UI population
            updateUI(currentLang);
        });
    </script>
</body>
</html>
